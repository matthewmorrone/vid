<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Video Router Demo</title>
  <script>
    // Apply persisted theme before loading main script to avoid flash of wrong theme.
    (function () {
      try {
        const settings = JSON.parse(localStorage.getItem('settings') || '{}');
        let mode = settings.theme || 'system';
        if (mode === 'system') {
          mode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        document.documentElement.classList.add(mode === 'dark' ? 'theme-dark' : 'theme-light');
      } catch (_) {
        console.error('Error applying theme:', _);
      }
    })();
  </script>
  <script src="app.js"></script>
</head>
<body>
  <nav>
    <a href="/" id="nav-home">Home</a>
    <a href="/stats" id="nav-stats">Stats</a>
    <a href="/report" id="nav-report">Artifacts</a>
    <a href="/settings" id="nav-settings">Settings</a>
    <a href="/facelab" id="nav-facelab">FaceLab</a>
  </nav>
  <div id="view"></div>
  <script>
    // Expose router globally so helpers can navigate
    window.router = new Router('view');
    router
      .register('/', () => {
        if (window.Settings && window.Settings.paging === 'list') {
          renderList({ containerId: 'view' });
        } else {
          renderGrid({ containerId: 'view' });
        }
      })
      .register('/video/:name', ({ name }) => {
        renderPlayer(name, { autoplay: true });
      })
      .register('/stats', () => {
        renderStats({ containerId: 'view' });
      })
      .register('/report', () => {
        renderReport({ containerId: 'view' });
      })
      .register('/settings', () => {
        renderSettings({ containerId: 'view' });
      })
      .register('/facelab', () => {
        renderFaceLab({ containerId: 'view' });
      });
    document.getElementById('nav-home').addEventListener('click', e => {
      e.preventDefault();
      router.navigate('/');
    });
    document.getElementById('nav-stats').addEventListener('click', e => {
      e.preventDefault();
      router.navigate('/stats');
    });
    document.getElementById('nav-report').addEventListener('click', e => {
      e.preventDefault();
      router.navigate('/report');
    });
    document.getElementById('nav-settings').addEventListener('click', e => {
      e.preventDefault();
      router.navigate('/settings');
    });
    document.getElementById('nav-facelab').addEventListener('click', e => {
      e.preventDefault();
      router.navigate('/facelab');
    });

    // Example static navigation; real app would query the API
    const videos = ['alpha', 'beta', 'gamma'];
    const list = document.createElement('ul');
    videos.forEach(name => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      const href = `/video/${encodeURIComponent(name)}`;
      a.href = href;
      a.textContent = `Video ${name}`;
      a.addEventListener('click', ev => {
        ev.preventDefault();
        router.navigate(href);
      });
      li.appendChild(a);
      list.appendChild(li);
    });
    document.body.insertBefore(list, document.getElementById('view'));
  </script>
</body>
</html>
